version: '3.8'

services:
  # Build Linux version
  build-linux:
    build:
      context: .
      dockerfile: Dockerfile.linux
    volumes:
      - ./Release:/workspace/Release
    container_name: choroboros-linux-builder
    command: bash -c "ls -lh Release/ && echo 'Build complete! Check ./Release directory'"

  # Test Linux build
  test-linux:
    build:
      context: .
      dockerfile: Dockerfile.linux-test
    volumes:
      - ./Release:/workspace/Release
    container_name: choroboros-linux-tester
    environment:
      - DISPLAY=${DISPLAY:-:0}
      - PULSE_SERVER=unix:/tmp/pulse-socket
    network_mode: host
    privileged: true
    depends_on:
      - build-linux
    command: /workspace/test.sh
