# Dockerfile for testing Choroboros Linux build
FROM ubuntu:22.04

# Avoid interactive prompts
ENV DEBIAN_FRONTEND=noninteractive

# Install runtime dependencies and testing tools
RUN apt-get update && apt-get install -y \
    libasound2 \
    libfreetype6 \
    libx11-6 \
    libxcomposite1 \
    libxcursor1 \
    libxext6 \
    libxinerama1 \
    libxrandr2 \
    libxrender1 \
    libwebkit2gtk-4.0-37 \
    libglu1-mesa \
    alsa-utils \
    pulseaudio \
    jackd2 \
    carla \
    vim \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Copy built plugin (assumes plugin is mounted or copied)
COPY Release/ /workspace/Release/

# Create test script
RUN echo '#!/bin/bash\n\
echo "Choroboros Linux Test Environment"\n\
echo "================================"\n\
echo ""\n\
echo "VST3 Location: /workspace/Release/VST3"\n\
echo "Standalone Location: /workspace/Release/Standalone"\n\
echo ""\n\
echo "To test with Carla:"\n\
echo "  carla --load-plugin /workspace/Release/VST3/Choroboros.vst3"\n\
echo ""\n\
echo "To test standalone:"\n\
echo "  /workspace/Release/Standalone/Choroboros"\n\
echo ""\n\
bash' > /workspace/test.sh && chmod +x /workspace/test.sh

CMD ["/workspace/test.sh"]
